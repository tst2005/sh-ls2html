#!/bin/sh

ls2html() {
	local quiet=false
	local render="simple"
	while [ $# -gt 0 ]; do
		case "$1" in
			(--help|-h)
				echo "Usage: $0 [options] [dir]"
				echo "Options: FILLME ..."
				return 0
			;;
			(--output)
				if [ -d "$1" ]; then
					outfile="$1/index.html"
				else
					outfile="$1"
				fi
			;;
			(-q|--quiet)
				quiet=true
			;;
			(--render)
				shift; render="$1"
			;;
			(--) shift; break ;;
			(*)
				echo >&2 "ERROR: unknown option $1"
				ls2html >&2 --help
				return 1
			;;
		esac
		shift
	done

	local dir
	[ $# -gt 0 ] && dir="$1" || dir="$(basename -- "$(pwd)")"

	case "$render" in
		(simple)
		########################################################################

		printf '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
 <head>
  <title>Index of %s</title>
 </head>
 <body>
<h1>Index of %s</h1>
  <table>
   <tr><th valign="top"><img src="/icons/blank.gif" alt="[ICO]"></th><th><a href="?C=N;O=D">Name</a></th><th><a href="?C=M;O=A">Last modified</a></th><th><a href="?C=S;O=A">Size</a></th><th><a href="?C=D;O=A">Description</a></th></tr>
   <tr><th colspan="5"><hr></th></tr>\n' \
"$dir" "$dir"

		printf '%s\n' '<tr><td valign="top"><img src="/icons/back.gif" alt="[PARENTDIR]"></td><td><a href="..">Parent Directory</a></td><td>&nbsp;</td><td align="right">  - </td><td>&nbsp;</td></tr>'

		for f in *; do
			printf '<tr><td valign="top"><img src="/icons/image2.gif" alt="[IMG]"></td><td><a href="%s">%s</a></td><td align="right">%s</td><td align="right">%s</td><td>&nbsp;</td></tr>' \
				"$f" "$f$([ ! -d "$f" ] || echo /)" 'DATE' 'SIZE'
		done

		printf '%s\n' '
   <tr><th colspan="5"><hr></th></tr>
</table>'

		if ! ${quiet:-false}; then
			printf '%s\n' 'Generated by <a href="https://github.com/tst2005/sh-ls2html"><b>ls2html.sh</b></a>'
		else
			printf '<!-- %s -->\n' 'Generated by <a href="https://github.com/tst2005/sh-ls2html"><b>ls2html.sh</b></a>'
		fi

		printf '%s\n' '</body></html>'
		########################################################################
		;;
		(next)
		printf '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
 <head>
  <title>Index of %s</title>
 </head>
 <body>
<h1>Index of %s</h1>
  <table>
   <tr><th valign="top"><img src="/icons/blank.gif" alt="[ICO]"></th><th><a href="?C=N;O=D">Name</a></th><th><a href="?C=M;O=A">Last modified</a></th><th><a href="?C=S;O=A">Size</a></th><th><a href="?C=D;O=A">Description</a></th></tr>
   <tr><th colspan="5"><hr></th></tr>\n' \
"$dir" "$dir"

		printf '%s\n' '<div class="wrapper">'

		printf '%s\n' '<tr><td valign="top"><img src="/icons/back.gif" alt="[PARENTDIR]"></td><td><a href="..">Parent Directory</a></td><td>&nbsp;</td><td align="right">  - </td><td>&nbsp;</td></tr>'

		for f in *; do
			printf '<tr><td valign="top"><img src="/icons/image2.gif" alt="[IMG]"></td><td><a href="%s">%s</a></td><td align="right">%s</td><td align="right">%s</td><td>&nbsp;</td></tr>' \
				"$f" "$f$([ ! -d "$f" ] || echo /)" 'DATE' 'SIZE'
		done

		printf '%s\n' '
   <tr><th colspan="5"><hr></th></tr>
</table>'

		if ! ${quiet:-false}; then
			printf '%s\n' 'Generated by <a href="https://github.com/tst2005/sh-ls2html"><b>ls2html.sh</b></a>'
		else
			printf '<!-- %s -->\n' 'Generated by <a href="https://github.com/tst2005/sh-ls2html"><b>ls2html.sh</b></a>'
		fi

		printf '%s\n' '
	<div class="block">
		You can add your own HTML above or below the directory listing.
	</div><!--/.postlisting-->
</div><!--/.wrapper-->
<div class="footer">
</div><!--/.footer-->
<script type="text/javascript">
// grab the 2nd child and add the parent class. tr:nth-child(2)
document.getElementsByTagName("tr")[1].className = "parent";
</script>
'

		printf '%s\n' '</body></html>'
		########################################################################
		;;
	esac
}

ls2html "$@"
